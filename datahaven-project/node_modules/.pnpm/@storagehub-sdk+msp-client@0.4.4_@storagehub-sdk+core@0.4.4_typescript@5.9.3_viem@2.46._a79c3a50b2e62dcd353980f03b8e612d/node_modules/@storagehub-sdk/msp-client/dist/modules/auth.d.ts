import type { NonceResponse, Session, UserInfo } from "../types.js";
import { type WalletClient } from "viem";
import { ModuleBase } from "../base.js";
export declare class AuthModule extends ModuleBase {
    /**
     * Request a nonce (challenge message) for Sign-In with Ethereum (SIWE).
     *
     * **Advanced use only:** Most users should use the `SIWE()` method instead, which handles the complete authentication flow automatically. This method is exposed only for custom authentication flows.
     *
     * **Important:** The challenge message expires after a short time (typically 5 minutes). You must call `verify()` with a valid signature before expiration.
     *
     * @param address - The Ethereum address requesting authentication (checksummed format recommended).
     * @param chainId - The chain ID the user is connected to.
     * @param domain - The domain (host[:port]) for the SIWE message (e.g., "datahaven.app" or "localhost:3000").
     * @param uri - The full URI of your application (e.g., "https://datahaven.app" or "http://localhost:3000").
     * @param signal - Optional AbortSignal for request cancellation.
     * @returns A promise resolving to the SIWE challenge message to be signed.
     */
    getNonce(address: string, chainId: number, domain: string, uri: string, signal?: AbortSignal): Promise<NonceResponse>;
    /**
     * Request a message (challenge) for Sign-In with X (SIWX) using CAIP-122 standard.
     *
     * **Advanced use only:** Most users should use the `SIWX()` method instead, which handles the complete authentication flow automatically. This method is exposed only for custom authentication flows.
     *
     * This method follows the CAIP-122 standard for chain-agnostic authentication.
     * The message uses CAIP-10 format for addresses (e.g., `eip155:55931:0x...`).
     *
     * **Important:** The challenge message expires after a short time (typically 5 minutes).
     * You must call `verify()` with a valid signature before expiration.
     *
     * **Note:** According to CAIP-122, the domain is extracted from the URI automatically.
     * You do not need to provide the domain separately - it will be extracted from the URI.
     *
     * @param address - The blockchain address requesting authentication (checksummed format recommended).
     * @param chainId - The chain ID the user is connected to.
     * @param uri - The full URI of your dApp (e.g., "https://datahaven.app"). This should be the dApp URL, not the MSP API URL.
     *   The domain will be automatically extracted from this URI per CAIP-122 specification.
     * @param signal - Optional AbortSignal for request cancellation.
     * @returns A promise resolving to the CAIP-122 challenge message to be signed.
     */
    getMessage(address: string, chainId: number, uri: string, signal?: AbortSignal): Promise<NonceResponse>;
    /**
     * Verify a Sign-In signature (works with both SIWE and SIWX/CAIP-122 messages).
     *
     * **Advanced use only:** Most users should use the `SIWE()` or `SIWX()` methods instead, which handle the complete authentication flow automatically. This method is exposed only for custom authentication flows.
     *
     * **Important:** You must store the returned Session object and provide it via the `sessionProvider` function passed to `MspClient.connect()`.
     * The session is not automatically persisted - you are responsible for managing session storage and ensuring your `sessionProvider` returns it for subsequent authenticated requests.
     *
     * @param message - The challenge message received from `getNonce()` (SIWE) or `getMessage()` (CAIP-122).
     * @param signature - The signature of the message signed by the user's wallet.
     * @param signal - Optional AbortSignal for request cancellation.
     * @returns A promise resolving to a Session object that you must store and provide via your sessionProvider.
     */
    verify(message: string, signature: string, signal?: AbortSignal): Promise<Session>;
    /**
     * Complete Sign-In with Ethereum (SIWE) authentication flow using a `WalletClient`.
     *
     * This is the recommended method for authentication. It handles the complete flow automatically:
     * derives the wallet address, fetches a nonce, prompts the user to sign the message, verifies the signature,
     * and returns a session token.
     *
     * **Important:** You must store the returned Session object and provide it via the `sessionProvider` function
     * passed to `MspClient.connect()`. The session is not automatically persisted - you are responsible for managing
     * session storage and ensuring your `sessionProvider` returns it for subsequent authenticated requests.
     *
     * **Note:** This method includes automatic retry logic for verification requests (default: 10 attempts with 100ms backoff).
     * The retry behavior can be customized via the `retry` parameter.
     *
     * @param wallet - The Viem `WalletClient` instance. Must have an active account set (`wallet.account`).
     *   - Browser wallets (e.g., MetaMask) automatically surface the user-selected address.
     *   - Viem/local wallets must set `wallet.account` explicitly before calling.
     * @param domain - The domain (host[:port]) for the SIWE message (e.g., "datahaven.app" or "localhost:3000").
     * @param uri - The full URI of your application (e.g., "https://datahaven.app" or "http://localhost:3000").
     * @param retry - Number of retry attempts for verification requests (default: 10).
     * @param signal - Optional AbortSignal for request cancellation.
     * @returns A promise resolving to a Session object that you must store and provide via your sessionProvider.
     */
    SIWE(wallet: WalletClient, domain: string, uri: string, retry?: number, signal?: AbortSignal): Promise<Session>;
    /**
     * Complete Sign-In with X (SIWX) authentication flow using CAIP-122 standard and a `WalletClient`.
     *
     * This is the recommended method for CAIP-122 authentication. It handles the complete flow automatically:
     * derives the wallet address, fetches a CAIP-122 message, prompts the user to sign the message, verifies the signature,
     * and returns a session token.
     *
     * **Important:** You must store the returned Session object and provide it via the `sessionProvider` function
     * passed to `MspClient.connect()`. The session is not automatically persisted - you are responsible for managing
     * session storage and ensuring your `sessionProvider` returns it for subsequent authenticated requests.
     *
     * **Note:** This method includes automatic retry logic for verification requests (default: 10 attempts with 100ms backoff).
     * The retry behavior can be customized via the `retry` parameter.
     *
     * **CAIP-122:** Unlike SIWE, this method does not require a `domain` parameter. The domain is automatically extracted
     * from the `uri` parameter on the backend per CAIP-122 specification.
     *
     * @param wallet - The Viem `WalletClient` instance. Must have an active account set (`wallet.account`).
     *   - Browser wallets (e.g., MetaMask) automatically surface the user-selected address.
     *   - Viem/local wallets must set `wallet.account` explicitly before calling.
     * @param uri - The full URI of your dApp (e.g., "https://datahaven.app"). This should be the dApp URL, not the MSP API URL.
     *   The domain will be automatically extracted from this URI per CAIP-122 specification.
     * @param retry - Number of retry attempts for verification requests (default: 10).
     * @param signal - Optional AbortSignal for request cancellation.
     * @returns A promise resolving to a Session object that you must store and provide via your sessionProvider.
     */
    SIWX(wallet: WalletClient, uri: string, retry?: number, signal?: AbortSignal): Promise<Session>;
    /**
     * Resolves and validates the account from a WalletClient.
     *
     * @param wallet - The Viem WalletClient instance.
     * @param methodName - The name of the calling method (for error messages).
     * @returns An object containing the account, checksummed address, and chainId.
     * @throws Error if the wallet has no active account.
     */
    private resolveAccount;
    /**
     * Signs a message and verifies it with retry logic.
     *
     * @param wallet - The Viem WalletClient instance.
     * @param account - The account to sign with.
     * @param message - The message to sign.
     * @param retry - Number of retry attempts for verification.
     * @param signal - Optional AbortSignal for request cancellation.
     * @param methodName - The name of the calling method (for error messages).
     * @returns A promise resolving to a Session object.
     */
    private signAndVerifyWithRetry;
    private delay;
    /**
     * Fetch authenticated user's profile.
     * - Requires valid `session` (Authorization header added automatically).
     */
    getProfile(signal?: AbortSignal): Promise<UserInfo>;
}
